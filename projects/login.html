<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <!-- form to allow script to authenticate w/ backend -->
    <form method="POST" id="myForm">

        <!-- form fields -->
        <fieldset>
            <!-- username field -->
            <div>
                <input type="text" id="usernameField" name="username" placeholder="Username">
            </div>

            <!-- password field -->
            <div>
                <input type="password" id="passwordField" name="password" placeholder="Password">
            </div>
        </fieldset>

        <!-- submit button -->
        <input type="hidden" id="csrfTokenField" name="csrf_token" value="">
        <div>
            <button type="submit">Submit</button>
        </div>

        <!-- signup button -->
        <a href="/frontend/register.html">Signup</a><br>
    </form>

    <script>
        async function submitForm() {
            // get the elements (username, password, etc)
            var username = document.getElementById('usernameField');
            var password = document.getElementById('passwordField');
            var form = document.getElementById('myForm');

            try {
                //const apiUrl = "https://whispbackend.duckdns.org/login";
                const apiUrl = "http://127.0.0.1:8086/api/users/authenticate"

                // Get the form data
                const formData = new FormData(form);
                console.log(form)

                // Send a POST request to your backend server
                const loginResponse = await fetch(apiUrl, {
                    method: 'POST',
                    body: formData,
                    mode: 'cors',
                });

                // error occured and login didn't work
                if (!loginResponse.ok) {
                    throw new Error('Login request was not successful');
                }

                const loginData = await loginResponse.json();

                if (loginData.success) {
                    // Login was successful, you can redirect or perform any other action
                    console.log('Login successful:', loginData.message);

                    localStorage.setItem("usernameData", username.value);
                    localStorage.setItem("flagData", 1);

                    window.location.href = "./chat.html"
                    window.location.replace("./chat.html")


                } else {
                    // Login failed, show an error message or take appropriate action
                    console.error('Login failed:', loginData.message);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        const form = document.getElementById('myForm');
        form.addEventListener('submit', function (event) {
            event.preventDefault();
            submitForm();
        });
    </script>
</body>

</html>